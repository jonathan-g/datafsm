<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Use a Genetic Algorithm to Estimate a Finite-state Machine Model — evolve_model • datafsm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Use a Genetic Algorithm to Estimate a Finite-state Machine Model — evolve_model"><meta property="og:description" content="evolve_model uses a genetic algorithm to estimate a finite-state
machine model, primarily for understanding and predicting decision-making."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">datafsm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/datafsm_introduction.html">Introduction to datafsm</a>
    </li>
    <li>
      <a href="../articles/FRD_vignette.html">Example with real data</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jonathan-g/datafsm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Use a Genetic Algorithm to Estimate a Finite-state Machine Model</h1>
    <small class="dont-index">Source: <a href="https://github.com/jonathan-g/datafsm/blob/main/R/evolve_model.R" class="external-link"><code>R/evolve_model.R</code></a></small>
    <div class="hidden name"><code>evolve_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>evolve_model</code> uses a genetic algorithm to estimate a finite-state
machine model, primarily for understanding and predicting decision-making.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">evolve_model</span><span class="op">(</span><span class="va">data</span>, test_data <span class="op">=</span> <span class="cn">NULL</span>, drop_nzv <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"accuracy"</span>, <span class="st">"sens"</span>, <span class="st">"spec"</span>, <span class="st">"ppv"</span><span class="op">)</span>,</span>
<span>        states <span class="op">=</span> <span class="cn">NULL</span>, cv <span class="op">=</span> <span class="cn">FALSE</span>, max_states <span class="op">=</span> <span class="cn">NULL</span>, k <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        actions <span class="op">=</span> <span class="cn">NULL</span>, seed <span class="op">=</span> <span class="cn">NULL</span>, popSize <span class="op">=</span> <span class="fl">75</span>,</span>
<span>        pcrossover <span class="op">=</span> <span class="fl">0.8</span>, pmutation <span class="op">=</span> <span class="fl">0.1</span>, maxiter <span class="op">=</span> <span class="fl">50</span>,</span>
<span>        run <span class="op">=</span> <span class="fl">25</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span>, priors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        verbose <span class="op">=</span> <span class="cn">TRUE</span>, return_best <span class="op">=</span> <span class="cn">TRUE</span>, ntimes <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.frame</code> that has columns named "period" and "outcome"
(period is the time period that the outcome action was taken), and one to
three additional columns, containing predictors.
All of the 3-5 columns should be named.
The period and outcome columns should be integer vectors and the columns
with the predictor variable data should be logical vectors
(<code>TRUE, FALSE</code>).
If the predictor variable data is not  logical, it will coerced to logical
with <br><code><a href="https://rdrr.io/r/base/logical.html" class="external-link">base::as.logical()</a></code>.</p></dd>


<dt id="arg-test-data">test_data<a class="anchor" aria-label="anchor" href="#arg-test-data"></a></dt>
<dd><p>Optional <code>data.frame</code> that has "period" and "outcome"
columns, with one to three additional columns containing predictors.
All of the (3-5 columns) should be named. The outcome variable is the
decision the decision-maker took for that period.
This <code>data.frame</code> should be in the same format and have the same order
of columns as the data.frame passed to the required <code>data</code> argument.</p></dd>


<dt id="arg-drop-nzv">drop_nzv<a class="anchor" aria-label="anchor" href="#arg-drop-nzv"></a></dt>
<dd><p>Optional logical vector length one specifying whether
predictors variables with variance in provided data near zero should be
dropped before model building. Default is <code>FALSE</code>. See
<code><a href="https://rdrr.io/pkg/caret/man/nearZeroVar.html" class="external-link">caret::nearZeroVar()</a></code>, which calls:<br><code><a href="https://rdrr.io/pkg/caret/man/nearZeroVar.html" class="external-link">caret::nzv()</a></code>.</p></dd>


<dt id="arg-measure">measure<a class="anchor" aria-label="anchor" href="#arg-measure"></a></dt>
<dd><p>Optional length one character vector that is either:
"accuracy", "sens", "spec", or "ppv". This specifies what measure of
predictive performance to use for training and evaluating the model. The
default measure is <code>"accuracy"</code>. However, accuracy can be a problematic
measure when the classes are imbalanced in the samples, i.e. if a class the
model is trying to predict is very rare. Alternatives to accuracy are
available that illuminate different aspects of predictive power. Sensitivity
answers the question, “ given that a result is truly an event, what is the
probability that the model will predict an event?” Specificity answers the
question, “given that a result is truly not an event, what is the
probability that the model will predict a negative?” Positive predictive
value answers, “what is the percent of predicted positives that are
actually positive?”</p></dd>


<dt id="arg-states">states<a class="anchor" aria-label="anchor" href="#arg-states"></a></dt>
<dd><p>Optional numeric vector with the number of states.
If not provided, will be set to <code>max(data$outcome)</code>.</p></dd>


<dt id="arg-cv">cv<a class="anchor" aria-label="anchor" href="#arg-cv"></a></dt>
<dd><p>Optional logical vector length one for whether cross-validation
should be conducted on training data to select optimal number of states.
This can drastically increase computation time because if <code>TRUE</code>, it
will run <code>evolve_model</code> <code>k*max_states</code> times to estimate optimal
value for states. Ties are broken by choosing the smaller number of states.
Default is <code>FALSE</code>.</p></dd>


<dt id="arg-max-states">max_states<a class="anchor" aria-label="anchor" href="#arg-max-states"></a></dt>
<dd><p>Optional numeric vector length one only relevant if
<code>cv==TRUE</code>. It specifies how up to how many states that
cross-validation should search through.
If not provided, will be set to <code>states + 1</code>.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Optional numeric vector length one only relevant if cv==TRUE,
specifying number of folds for cross-validation.</p></dd>


<dt id="arg-actions">actions<a class="anchor" aria-label="anchor" href="#arg-actions"></a></dt>
<dd><p>Optional numeric vector with the number of actions. If not
provided, then actions will be set as the number of unique values in the
outcome vector.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Optional numeric vector length one.</p></dd>


<dt id="arg-popsize">popSize<a class="anchor" aria-label="anchor" href="#arg-popsize"></a></dt>
<dd><p>Optional numeric vector length one specifying the size of the
GA population. A larger number will increase the probability of finding a
very good solution but will also increase the computation time. This is
passed to the GA::ga() function of the <strong>GA</strong> package.</p></dd>


<dt id="arg-pcrossover">pcrossover<a class="anchor" aria-label="anchor" href="#arg-pcrossover"></a></dt>
<dd><p>Optional numeric vector length one specifying probability of
crossover for GA. This is passed to the GA::ga() function of the <strong>GA</strong>
package.</p></dd>


<dt id="arg-pmutation">pmutation<a class="anchor" aria-label="anchor" href="#arg-pmutation"></a></dt>
<dd><p>Optional numeric vector length one specifying probability of
mutation for GA. This is passed to the GA::ga() function of the <strong>GA</strong>
package.</p></dd>


<dt id="arg-maxiter">maxiter<a class="anchor" aria-label="anchor" href="#arg-maxiter"></a></dt>
<dd><p>Optional numeric vector length one specifying max number of
iterations for stopping the GA evolution. A larger number will increase the
probability of finding a very good solution but will also increase the
computation time. This is passed to the GA::ga() function of the <strong>GA</strong>
package. <code>maxiter</code> is scaled by how many parameters are in the model:<br><code>maxiter &lt;- maxiter + ((maxiter*(nBits^2)) / maxiter)</code>.</p></dd>


<dt id="arg-run">run<a class="anchor" aria-label="anchor" href="#arg-run"></a></dt>
<dd><p>Optional numeric vector length one specifying max number of
consecutive iterations without improvement in best fitness score for
stopping the GA evolution. A larger number will increase the probability of
finding a very good solution but will also increase the computation time.
This is passed to the GA::ga() function of the <strong>GA</strong> package.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Optional logical vector length one. For running the GA
 evolution in parallel. Depending on the number of cores registered and the
memory on your machine, this can make the process much faster, but only works
for Unix-based machines that can fork the processes.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>Optional numeric matrix of solutions strings to be included in
the initialization. User needs to use a decoder function to translate prior
decision models into bits and then provide them. If this is not specified,
then random priors are automatically created.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Optional logical vector length one specifying whether helpful
messages should be displayed on the user's console or not.</p></dd>


<dt id="arg-return-best">return_best<a class="anchor" aria-label="anchor" href="#arg-return-best"></a></dt>
<dd><p>Optional logical vector length one specifying whether to
return just the best model or all models. Only relevant if ntimes &gt; 1.
Default is TRUE.</p></dd>


<dt id="arg-ntimes">ntimes<a class="anchor" aria-label="anchor" href="#arg-ntimes"></a></dt>
<dd><p>Optional integer vector length one specifying the number of
times to estimate model. Default is 1 time.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Returns an S4 object of class ga_fsm. See <a href="ga_fsm-class.html">ga_fsm</a> for the
 details of the slots (objects) that this type of object will have and for
 information on the methods that can be used to summarize the calling and
 execution of <code>evolve_model()</code>, including <code>summary</code>, <code>print</code>,
 and <code>plot</code>. Timing measurement is in seconds.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This is the main function of the <strong>datafsm</strong> package. It relies on the
<strong>GA</strong> package for genetic algorithm optimization. <code>evolve_model</code>
takes data on predictors and data on the outcome. It automatically creates a
fitness function that takes the data, an action vector <code>evolve_model</code>
generates, and a state matrix <code>evolve_model</code> generates as input and
returns numeric vector of the same length as the <code>outcome</code>.
<code>evolve_model</code> then computes a fitness score for that potential solution
FSM by comparing it to the provided <code>outcome</code>. This is repeated for every
FSM in the population and then the probability of selection for the next
generation is proportional to the fitness scores. The default is also for the
function to call itself recursively while varying the number of states inside
a cross-validation loop in order to estimate the optimal number of states.</p>
<p>If parallel is set to TRUE, then these evaluations are distributed across the
available processors of the computer using the <strong>doParallel</strong> package,
otherwise, the evaluations of fitness are conducted sequentially. Because
this fitness function that <code>evolve_model</code> creates must loop through all
the data every time it is evaluated and we need to evaluate many possible
solution FSMs, the fitness function is implemented in C++ so it is very fast.</p>
<p><code>evolve_model</code> uses a stochastic meta-heuristic optimization routine to
estimate the parameters that define a FSM model. Generalized simulated
annealing, or tabu search could work, but they are more difficult to
parallelize. The current version uses the <strong>GA</strong> package's genetic
algorithm because GAs perform well in rugged search spaces to solve integer
optimization problems, are a natural complement to our binary string
representation of FSMs, and are easily parallelized.</p>
<p>This function evolves the models on training data and then, if a test set is
provided, uses the best solution to make predictions on test data. Finally,
the function returns the GA object and the decoded version of the best string
in the population. See <a href="ga_fsm-class.html">ga_fsm</a> for the details of the slots
(objects) that this type of object will have.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Luca Scrucca (2013). GA: A Package for Genetic Algorithms in R.
 Journal of Statistical Software, 53(4), 1-37. URL
 <a href="https://www.jstatsoft.org/v53/i04/" class="external-link">https://www.jstatsoft.org/v53/i04/</a>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Create data:</span></span></span>
<span class="r-in"><span><span class="va">cdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">5000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   my.decision1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">0</span>, <span class="fl">10000</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   other.decision1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">0</span>, <span class="fl">10000</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">evolve_model</span><span class="op">(</span><span class="va">cdata</span>, cv<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, action_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://luca-scr.github.io/GA/" class="external-link">GA</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="estimation_details.html">estimation_details</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># In scripts, it can makes sense to set parallel to</span></span></span>
<span class="r-in"><span><span class="co"># 'as.logical(Sys.info()['sysname'] != 'Windows')'.</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by John J. Nay, Jonathan M. Gilligan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

