<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example with real data • datafsm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example with real data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">datafsm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/datafsm_introduction.html">Introduction to datafsm</a>
    </li>
    <li>
      <a href="../articles/FRD_vignette.html">Example with real data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonathan-g/datafsm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example with real data</h1>
                        <h4 data-toc-skip class="author">John Nay</h4>
            
            <h4 data-toc-skip class="date">2015-08-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jonathan-g/datafsm/blob/main/vignettes/FRD_vignette.Rmd" class="external-link"><code>vignettes/FRD_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>FRD_vignette.Rmd</code></div>

    </div>

    
    
<p>This document applies the <code>datafsm</code> software package <span class="citation">(Nay and Gilligan 2015)</span> to the data from <span class="citation">Fudenberg, Rand, and Dreber (2012)</span>. For the
motivation, underlying design, and tests on simulated data see <span class="citation">Nay and Gilligan (2015)</span>. For a simple example of
how to use the package see the “<a href="datafsm_introduction.html">Introduction to datafsm</a>”
vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jonathan-g.github.io/datafsm/">datafsm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1533406114</span><span class="op">)</span></span></code></pre></div>
<p>Estimating a model is as simple as ensuring the input data,
e.g. <code>prepped</code>, is in the correct format and calling
<code>evolve_model(prepped)</code>. Here, we loop through the six
experimental treatments in the data and estimate a separate model for
each, storing the results in a list we name <code>res</code>. The
<code>parallel</code> argument allows this work to automatically be
spread across all available processors on the computer. This
parallelization, combined with the implementation of the core
computation in C++, speeds up estimation considerably.</p>
<p>The datafsm package includes a dataset from <span class="citation">Nay and Vorobeychik (2016)</span>, which represents
168,386 rounds of play in 30 different variations on the iterated
prisoner’s dilemma game. This example will focus on the six games
studied by <span class="citation">Fudenberg, Rand, and Dreber
(2012)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">NV_games</span>, package <span class="op">=</span> <span class="st">"datafsm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">group_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>g1 <span class="op">=</span> <span class="fl">15</span>, g2 <span class="op">=</span> <span class="fl">16</span>, g3 <span class="op">=</span> <span class="fl">17</span>, g4 <span class="op">=</span> <span class="fl">14</span>, g5 <span class="op">=</span> <span class="fl">13</span>, g6 <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"label"</span>,</span>
<span>                               values_to <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped</span> <span class="op">&lt;-</span> <span class="va">NV_games</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>,</span>
<span>  outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">my.decision</span> <span class="op">==</span> <span class="st">"coop"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>  period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span>,</span>
<span>  my.decision1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">my.decision1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  other.decision1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">other.decision1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">group_df</span><span class="op">$</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">group_df</span>, by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">group_indices</span> <span class="op">&lt;-</span> <span class="va">prepped</span><span class="op">$</span><span class="va">group</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">group_seeds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">integer.max</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group_indices</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">group_indices</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">patterns</span> <span class="op">&lt;-</span> <span class="va">NV_games</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">error</span>, <span class="va">r</span>, <span class="va">t</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">group_df</span>, by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">label</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">group_indices</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">group_indices</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"\nAnalyzing group "</span>, <span class="va">x</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">prepped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/evolve_model.html">evolve_model</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 seed <span class="op">=</span> <span class="va">group_seeds</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object has methods for inspecting (<code>print</code>,
<code>show</code>, <code>summary</code>,
<code>estimation_details</code>, <code>best_performance</code>,
<code>varImp</code>, <code>states</code>), visualizing
(<code>plot</code>, <code>barplot</code>, <code>dotchart</code>), and
predicting new data (<code>predict</code>). Below we use the plot and
barplot methods to see the resulting model and the associated relative
importance of the predictor variables. In this case, the predictor
variables are the outcomes of the decisions in the previous period of
the game and the outcome variable (the current state) is the action the
model predicts the agent will take in the current period. The state on
the far left is the starting state.</p>
<p>The variable importance is computed by switching each value of an
estimated model’s state matrix to another value in its feasible range,
measuring the decrease in goodness of fit to the data, normalizing the
values so the largest is 100, then summing across each column to
estimate the relative importance of each predictor variable across all
states.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">group_indices</span></span>
<span><span class="va">tl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dd"</span>, <span class="st">"cd"</span>, <span class="st">"dc"</span>, <span class="st">"cc"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pattern</span> <span class="op">&lt;-</span> <span class="va">patterns</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="va">name</span><span class="op">)</span></span>
<span>  <span class="va">this_res</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">this_res</span>,</span>
<span>       action_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="../reference/action_vec.html">action_vec</a></span><span class="op">(</span><span class="va">this_res</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>,</span>
<span>       transition_label <span class="op">=</span> <span class="va">tl</span>,</span>
<span>       maintitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Error: "</span>, <span class="va">pattern</span><span class="op">$</span><span class="va">error</span>,</span>
<span>                          <span class="st">", Reward: "</span>, <span class="va">pattern</span><span class="op">$</span><span class="va">r</span>,</span>
<span>                          <span class="st">", Temptation: "</span>, <span class="va">pattern</span><span class="op">$</span><span class="va">t</span>,</span>
<span>                          <span class="st">"\n In-sample accuracy (n= "</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prepped</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="va">name</span><span class="op">)</span>,</span>
<span>                                  big.mark<span class="op">=</span><span class="st">','</span>,digits<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,<span class="st">") : "</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/best_performance.html">best_performance</a></span><span class="op">(</span><span class="va">this_res</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">this_res</span>, names.arg<span class="op">=</span><span class="va">tl</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="frd-fig-plot_results-1.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-2.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-3.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-4.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-5.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-6.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-7.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-8.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-9.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-10.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-11.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;"><img src="frd-fig-plot_results-12.png" title="plot of chunk plot_results" alt="plot of chunk plot_results" style="display: block; margin: auto;">
These variable importance plots of the six models capture ways in which
the game design affects player behavior. The first two models are from
the games where the error is zero or low: the <code>cc</code> outcome is
by far the strongest predictor of play. Compare this to the next four
models where error is higher: the <code>dd</code> becomes much more
important. Now compare the third and fourth models from games with
payoffs more amenable to cooperation to the fifth and sixth models from
games with payoffs less amenable to cooperation: the <code>dd</code>
outcome is more important in the latter. We can summarize this main
pattern with a table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_minus_d</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="../reference/varImp.html">varImp</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="../reference/varImp.html">varImp</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">c_minus_d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"c_minus_d"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">patterns</span>, by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">error</span>, <span class="va">r</span>, <span class="va">t</span>, <span class="va">c_minus_d</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Error <span class="op">=</span> <span class="va">error</span>, Reward <span class="op">=</span> <span class="va">r</span>, Temptation <span class="op">=</span> <span class="va">t</span>,</span>
<span>         <span class="st">"CC Imp. Re. to DD"</span> <span class="op">=</span> <span class="va">c_minus_d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html" class="external-link">pander</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<table style="width:71%;" class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="18%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="center">Error</th>
<th align="center">Reward</th>
<th align="center">Temptation</th>
<th align="center">CC Imp. Re. to DD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0.264</td>
<td align="center">0.33</td>
<td align="center">77.55</td>
</tr>
<tr class="even">
<td align="center">0.0625</td>
<td align="center">0.264</td>
<td align="center">0.33</td>
<td align="center">65.16</td>
</tr>
<tr class="odd">
<td align="center">0.125</td>
<td align="center">0.264</td>
<td align="center">0.33</td>
<td align="center">12.09</td>
</tr>
<tr class="even">
<td align="center">0.125</td>
<td align="center">0.165</td>
<td align="center">0.231</td>
<td align="center">23.68</td>
</tr>
<tr class="odd">
<td align="center">0.125</td>
<td align="center">0.132</td>
<td align="center">0.198</td>
<td align="center">-30.7</td>
</tr>
<tr class="even">
<td align="center">0.125</td>
<td align="center">0.099</td>
<td align="center">0.165</td>
<td align="center">-15.37</td>
</tr>
</tbody>
</table>
<p>These were all two-state models, which is the default. When we call
<code>evolve_model</code> we can either manually set the number of
states, states, or we can set the argument <code>cv</code> to
<code>TRUE</code>, which then estimates the out-of-sample performance
through <em>k</em>-fold cross-validation on the training data for many
values of the number of states to determine the number of states with
best out-of-sample performance for the given dataset (and the given
split into <em>k</em>-folds, which it should be relatively insensitive
to).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k_fold_seeds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">integer.max</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">group_indices</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">group_indices</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">group_indices</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"\nPerforming k-fold cross-validation for group "</span>, <span class="va">x</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="co"># Note: When parallel is set TRUE, evolve_model processes the first few</span></span>
<span>  <span class="co"># groups successfully, but then GA::ga crashes with "mcfork() unable to</span></span>
<span>  <span class="co"># create pipe" when evolving the model for the third or fourth group</span></span>
<span>  <span class="co"># (the exact time it crashes varies from run to run on the same machine).</span></span>
<span>  <span class="co"># There is no similar problem when evolving models with parallel = TRUE</span></span>
<span>  <span class="co"># in the analyze_data chunk.</span></span>
<span>  <span class="va">cv_res</span> <span class="op">&lt;-</span> <span class="va">prepped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/evolve_model.html">evolve_model</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 cv <span class="op">=</span> <span class="cn">TRUE</span>, max_states <span class="op">=</span> <span class="fl">6</span>, k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                 seed <span class="op">=</span> <span class="va">k_fold_seeds</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"\nFinished k-fold cross-validation for group "</span>, <span class="va">x</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">cv_res</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">group_indices</span></span>
<span><span class="va">res2states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">res2</span>, <span class="va">states</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"group"</span>, values_to <span class="op">=</span> <span class="st">"states"</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">patterns</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">res2states</span>, by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>Error <span class="op">=</span> <span class="va">error</span>, Reward <span class="op">=</span> <span class="va">r</span>, Temptation <span class="op">=</span> <span class="va">t</span>, States <span class="op">=</span> <span class="va">states</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html" class="external-link">pander</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span></code></pre></div>
<table style="width:56%;" class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="18%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">Error</th>
<th align="center">Reward</th>
<th align="center">Temptation</th>
<th align="center">States</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0.264</td>
<td align="center">0.33</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">0.0625</td>
<td align="center">0.264</td>
<td align="center">0.33</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">0.125</td>
<td align="center">0.264</td>
<td align="center">0.33</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">0.125</td>
<td align="center">0.165</td>
<td align="center">0.231</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">0.125</td>
<td align="center">0.132</td>
<td align="center">0.198</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">0.125</td>
<td align="center">0.099</td>
<td align="center">0.165</td>
<td align="center">2</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-fudenberg2012" class="csl-entry">
Fudenberg, Drew, David G Rand, and Anna Dreber. 2012. <span>“Slow to
Anger and Fast to Forgive: Cooperation in an Uncertain World.”</span>
<em>American Economic Review</em> 102 (2): 720–49. <a href="https://doi.org/10.1257/aer.102.2.720" class="external-link">https://doi.org/10.1257/aer.102.2.720</a>.
</div>
<div id="ref-nay2015" class="csl-entry">
Nay, John J., and Jonathan M. Gilligan. 2015. <span>“Data-Driven Dynamic
Decision Models.”</span> In <em>Proceedings of the 2015 Winter
Simulation Conference</em>, 2752–63. IEEE Press. <a href="https://doi.org/10.1109/WSC.2015.7408381" class="external-link">https://doi.org/10.1109/WSC.2015.7408381</a>.
</div>
<div id="ref-nay2016" class="csl-entry">
Nay, John J., and Yevgeniy Vorobeychik. 2016. <span>“Predicting Human
Cooperation.”</span> <em>PLOS ONE</em> 11 (5): e0155656. <a href="https://doi.org/10.1371/journal.pone.0155656" class="external-link">https://doi.org/10.1371/journal.pone.0155656</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John J. Nay, Jonathan M. Gilligan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
